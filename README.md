# Система сбора LOG файлов ПК Спринтер

Утилита автоматического сбора log и ini файлов ПК "Спринтер"

### Алгоритм работы:

1. **Запрашивает у пользователя путь до корневого каталога ПК "Спринтер"**  
   По умолчанию предлагается каталог из которого запущено приложение.  
   Пользователь может указать свой вариант передав команду **<u>"n"</u>** или согласиться  
   с предложенным вариантом передав команду **<u>"y"</u>**.  
   Если командна не будет распосзнана, программа начнется сначала.


2. **От заданного каталога строит путь до папки BOXES и сканирует её на наличие системных ящиков**  
   Если папка BOXES существует, сканирует вложенные в неё папки и проверяет их имена на соответсвиие  
   патерну (системный ящик). Запоминает найденные системные ящики. В дальнейшем их имена будут  
   использованы для сбора файлов:  
   - Protokol_логин организации.log (C:\Dipost\log\\Referent)
   - ref_crypto_логин организации.log (C:\Dipost\log\Referent)  
   
   Если папка BOXES не существует, будет выведено соответствующее предупреждение.  
   Выполнение программы продолжиться.
   
   
3. **От заданного каталога строит пути к log файлам и првоеряет их существование в системе**  
   Если log файл существует, запоминает его для дальнейшего копирования. В ходе работы  
   строятся пути и проверяется существование файлов:  
   - Referent.log
   - CPCrypto.ini
   - Referent0.ini
   - referent.ini
   - Referent_Setup.ini
   - Reftransport.log
   - FormatCheck.log
   - DocEngineError.log
   - dbconnection.ini
   - WebModuleSystemConverter.log
   - WebModuleSystem.log
   - MkOnlineProxyNew.log
   
   Если папка BOXES содержала системные ящики, то по каждому из них:  
   - Protokol_логин организации.log
   - ref_crypto_логин организации.log  

  Если по итогу проверки не будет найдено ни одного log файла, будет вызвано исключение,  
  сообщающие пользователю о том, что выбранная директория не является корневым каталогом ПК "Спринтер".  
  Программа будет перезапущена.

4. **Создаёт папку в корневом каталоге, в которую будет произвоодиться копирование**  
   В выбранном каталоге создаётся папка с именем по маске ДД-ММ-ГГГГ_ЧЧ-ММ_LOG файлы  


5. **Производит копирование найденных в шаге 3 файлов в папку созданную в шаге 4**  
   Если расширение файла не являтеся .log, копирует в том виде в котором есть.  
   Если расширение файла .log, проверяется его размер и количество строк в нём.  
   Если размер файла больше **<u>2 Мб</u>** и он содержит более **<u>5000</u>** строк,производит копирование только  
   последних 5000 строк (создаёт в выходном каталоге файл с таким же именем, читает оригинал и переписывает  
   из него строки в созданный экземпляр). В ином случае копирует файл без изменений.  
   При возникновении исключений при копировании, пользователю будет выведено соответствующие сообщение  
   с текстом ошибки. Программа будет перезапущена.  


6. **Упаковывает скопированные файлы в zip архив**  
   В корневом каталоге (выбранном в 1 шаге) создаётся zip архив с именем по маске ДД-ММ-ГГГГ_ЧЧ-ММ_LOG файлы.zip  
   и в него производиться упаковка собранных файлов.  
   Если упаковка прошла успешно, пользователю будет сообщен путь к архиву и его имя.  
   Папка, которая использовалась для копирования, будет автоматически удалена.  
   При возникновении исключений в процессе упаковки, пользователю будет выведено сообщение с  
   ошибкой, а так же предложением упаковать итоговую папку в архив "руками". Папка при этом не будет удалена.
